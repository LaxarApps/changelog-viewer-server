{"version":3,"sources":["../../../../../../home/awilden/work/AS3/laxar/changelog-viewer-server/index.es6"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Copyright 2015 aixigo AG\n * Released under the MIT license.\n */\nimport { readFile } from 'fs';\nimport { createServer } from 'http';\nimport { Promise } from 'es6-promise';\nimport { Resource as HalResource } from 'hal';\nimport connect from 'connect';\nimport Router from 'routes';\nimport url from 'url';\nimport createBroker from './lib/adapter_broker';\n\n\nnew Promise( ( resolve, reject ) => {\n   readFile( './config.json', ( err, string ) =>  err ? reject( err ) : resolve( string ) );\n} )\n   .then( string => JSON.parse( string ) )\n   .then( startServer, err => console.error( `An error occurred while reading the config file (config.json): ${err}` ) )\n   .catch( err => {\n      console.error( `An error occurred while starting the server: ${err}` );\n      console.error( 'Stack: ', err.stack );\n   } );\n\nconst routes = {\n   ROOT: '/',\n   CATEGORIES: '/categories',\n   CATEGORY_BY_ID: '/categories/:categoryId',\n   REPOSITORIES_BY_CATEGORY: '/categories/:categoryId/repositories',\n   REPOSITORIES: '/repositories',\n   REPOSITORY_BY_ID: '/repositories/:globalRepositoryId',\n   REPOSITORY_RELEASES: '/repositories/:globalRepositoryId/releases',\n   REPOSITORY_RELEASE_BY_ID: '/repositories/:globalRepositoryId/releases/:releaseId'\n};\nconst relations = {\n   CATEGORY: 'category',\n   CATEGORIES: 'categories',\n   REPOSITORIES: 'repositories',\n   REPOSITORY: 'repository',\n   RELEASE: 'release',\n   RELEASES: 'releases'\n};\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction startServer( config ) {\n\n   const router = new Router();\n   const server = connect();\n   const broker = createBroker( config );\n\n   server.use( ( req, res ) => {\n      const path = url.parse( req.url ).pathname;\n      const match = router.match( path );\n\n      if( !match ) {\n         console.warn( `Found no match for url \"${req.url}\".` );\n         res.statusCode = 404;\n         res.end();\n         return;\n      }\n\n      match.fn( req, res, match );\n   } );\n\n   addRoutes( config, router, broker );\n\n   createServer( server ).listen( config.port || 8000 );\n\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction addRoutes( config, router, broker ) {\n\n   addHalRoute( routes.ROOT, () => {\n      const resource = new HalResource( {}, routes.ROOT );\n      resource.link( relations.CATEGORIES, routes.CATEGORIES );\n      return resource;\n   } );\n\n   addHalRoute( routes.CATEGORIES, () => {\n      const categoriesResource = new HalResource( {}, routes.CATEGORIES );\n      return broker.getCategories()\n         .then( categories => {\n            return Promise.all( categories.map( category => {\n               const categoryResource = resourceForCategory( category );\n               categoriesResource.link( relations.CATEGORY, hrefForCategory( category ) );\n               categoriesResource.embed( relations.CATEGORY, categoryResource, false );\n\n               return broker.getRepositories( category.id )\n                  .then( repositories => {\n                     const repositoriesResource = resourceForRepositories( repositories, {\n                        href: hrefForRepositoriesByCategory( category ),\n                        embedded: true\n                     } );\n                     categoryResource.embed( relations.REPOSITORIES, repositoriesResource, false );\n                  } );\n            } ) );\n         } )\n         .then( () => categoriesResource );\n   } );\n\n   addHalRoute( routes.CATEGORY_BY_ID, ( { categoryId } ) => {\n      return broker.findCategoryById( categoryId )\n         .then( category => category ? resourceForCategory( category ) : null );\n   } );\n\n   addHalRoute( routes.REPOSITORIES_BY_CATEGORY, ( { categoryId } ) => {\n      return broker.findCategoryById( categoryId )\n         .then( category => {\n            if( !category ) {\n               return null;\n            }\n\n            const hrefForRepositories = hrefForRepositoriesByCategory( category );\n            return broker.getRepositories( category.id )\n               .then( repositories => resourceForRepositories( repositories, { href: hrefForRepositories } ) );\n         } );\n   } );\n\n   addHalRoute( routes.REPOSITORIES, () => {\n      return broker.getCategories()\n         .then( categories => {\n            return Promise.all( categories.map( category => broker.getRepositories( category.id ) ) )\n               .then( repositoriesLists => [].concat.apply( [], repositoriesLists ) );\n         } )\n         .then( repositories => {\n            return resourceForRepositories( repositories );\n         } );\n   } );\n\n   addHalRoute( routes.REPOSITORY_BY_ID, ( { globalRepositoryId } ) => {\n      const [ adapterId, repositoryId ] = globalRepositoryId.split( '__' );\n      return broker.findRepositoryById( adapterId, repositoryId )\n         .then( repository => repository ? resourceForRepository( repository ) : null );\n   } );\n\n   addHalRoute( routes.REPOSITORY_RELEASES, ( { globalRepositoryId } ) => {\n      const [ adapterId, repositoryId ] = globalRepositoryId.split( '__' );\n      return broker.findRepositoryById( adapterId, repositoryId )\n         .then( repository => {\n            if( !repository ) {\n               return null;\n            }\n\n            return repository.getReleases()\n               .then( releases => resourceForReleasesByRepository( repository, releases ) );\n         } );\n   } );\n\n   addHalRoute( routes.REPOSITORY_RELEASE_BY_ID, ( { globalRepositoryId, releaseId } ) => {\n      const [ adapterId, repositoryId ] = globalRepositoryId.split( '__' );\n      return broker.findRepositoryById( adapterId, repositoryId )\n         .then( repository => {\n            if( !repository ) {\n               return null;\n            }\n\n            return repository.getReleaseByVersion( releaseId )\n               .then( release => resourceForRelease( repository, release ) );\n         } );\n   } );\n\n   ///////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n   const now = () => new Date().getTime()\n   const stillValid = ( { timestamp } ) => timestamp > now() - ( config.maxAgeMs || 2 * 60 * 60 * 1000 );\n   let resourcesCache = {};\n\n   function addHalRoute( route, resourceBuilder ) {\n      router.addRoute( route, ( req, res, match ) => {\n\n         const { url } = req;\n         const timeoutPromise = new Promise( ( resolve, reject ) => {\n            setTimeout( reject.bind( null, 'Request timed out.' ), config.requestTimeout || 60000 );\n         } );\n\n         if( url in resourcesCache && stillValid( resourcesCache[ url ] ) ) {\n            console.log( `resource cache HIT for ${url}` );\n            return processResourceBuilderResult( resourcesCache[ url ].resource );\n         }\n         console.log( `resource cache MISS for ${url}` );\n\n         Promise.race( [ timeoutPromise, resourceBuilder( match.params, req, res ) ] )\n            .then( resource => {\n               if( resource ) {\n                  resourcesCache[ url ] = { timestamp: now(), resource };\n               }\n               return resource;\n            } )\n            .then( processResourceBuilderResult )\n            .catch( error => {\n               const errorMessage = typeof error === 'string' ? error : 'Unknown internal error';\n               if( error instanceof Error ) {\n                  console.error( `An error occurred while serving request to ${route}: ${error}` );\n                  console.error( 'Stack: ', error.stack );\n               }\n\n               res.statusCode = 500;\n               res.write( errorMessage );\n               res.end();\n            } );\n\n         function processResourceBuilderResult( resource ) {\n            if( resource ) {\n               writeCommonHeaders( res );\n\n               res.write( JSON.stringify( resource.toJSON(), null, 3 ) );\n            }\n            else {\n               res.statusCode = 404;\n            }\n            res.end();\n         }\n\n      } );\n   }\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst hrefForCategory = category => createUrl( routes.CATEGORY_BY_ID, { categoryId: category.id } );\nfunction resourceForCategory( category ) {\n   const categoryResource = new HalResource( category, hrefForCategory( category ) );\n   categoryResource.link( relations.REPOSITORIES, hrefForRepositoriesByCategory( category ) );\n   return categoryResource;\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst hrefForRepositories = category => createUrl( routes.REPOSITORIES, {} );\nconst hrefForRepositoriesByCategory = category => createUrl( routes.REPOSITORIES_BY_CATEGORY, { categoryId: category.id } );\nfunction resourceForRepositories( repositories, { embedded=false, href=null}={} ) {\n   const repositoriesResource = new HalResource( {}, href || hrefForRepositories() );\n   repositories.forEach( repository => {\n      const repositoryResource = resourceForRepository( repository );\n\n      repositoriesResource.link( relations.REPOSITORY, hrefForRepository( repository ) );\n      if( embedded ) {\n         repositoriesResource.embed( relations.REPOSITORY, repositoryResource, false );\n      }\n   } );\n   return repositoriesResource;\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst hrefForRepository = repository => createUrl( routes.REPOSITORY_BY_ID, { globalRepositoryId: globalRepositoryId( repository ) } );\nfunction resourceForRepository( repository ) {\n   const repositoryHref = hrefForRepository( repository );\n   const repositoryResource = new HalResource( {\n      title: repository.name,\n      pushedAt: repository.pushed_at\n   }, repositoryHref );\n   repositoryResource.link( relations.RELEASES, `${repositoryHref}/releases` );\n   return repositoryResource;\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst hrefForReleaseByRepository = ( repository, release ) => {\n   return createUrl( routes.REPOSITORY_RELEASE_BY_ID, {\n      globalRepositoryId: globalRepositoryId( repository ),\n      releaseId: release.title\n   } );\n};\nfunction resourceForRelease( repository, release ) {\n   const releasehref = hrefForReleaseByRepository( repository, release );\n   return new HalResource( release, releasehref );\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst hrefForReleasesByRepository = repository => createUrl( routes.REPOSITORY_RELEASES, { globalRepositoryId: globalRepositoryId( repository ) } );\nfunction resourceForReleasesByRepository( repository, releases ) {\n   const releasesHref = hrefForReleasesByRepository( repository );\n   const releasesResource = new HalResource( {}, releasesHref );\n   releases.forEach( release => {\n      releasesResource.link( relations.RELEASE, {\n         href: hrefForReleaseByRepository( repository, release ),\n         title: release.name\n      } );\n   } );\n   return releasesResource;\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction globalRepositoryId( repository ) {\n   return encodeURIComponent( `${repository.__adapterId}__${repository.id}` );\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction createUrl( route, params ) {\n   return Object.keys( params ).reduce( ( url, key ) => url.replace( `:${key}`, params[ key ] ), route );\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction writeCommonHeaders( res ) {\n   res.setHeader( 'Content-Type', 'application/hal+json' );\n}\n"]}